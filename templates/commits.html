<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Analyse des Commits GitHub</title>
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f8f9fa;
            color: #333;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        .header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        h1 {
            color: #2c3e50;
            margin-bottom: 10px;
        }
        .chart-wrapper {
            margin-bottom: 40px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            padding: 20px;
        }
        .chart-title {
            font-size: 20px;
            color: #2c3e50;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid #eee;
        }
        .chart {
            width: 100%;
            height: 400px;
        }
        .loading {
            text-align: center;
            padding: 50px;
            font-size: 18px;
            color: #7f8c8d;
        }
        .error {
            color: #e74c3c;
            text-align: center;
            padding: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Analyse des Commits GitHub</h1>
            <p>Dépôt : Gaye93/5MCSI_Metriques</p>
        </div>

        <!-- Graphique par date -->
        <div class="chart-wrapper">
            <div class="chart-title">Commits par Date</div>
            <div id="date_chart" class="chart">
                <div class="loading">Chargement des données par date...</div>
            </div>
        </div>

        <!-- Graphique par minute -->
        <div class="chart-wrapper">
            <div class="chart-title">Commits par Minute de l'Heure</div>
            <div id="minute_chart" class="chart">
                <div class="loading">Chargement des données par minute...</div>
            </div>
        </div>
    </div>

    <script>
        google.charts.load('current', { packages: ['corechart'] });
        google.charts.setOnLoadCallback(loadCommitData);

        function loadCommitData() {
            const apiUrl = 'https://api.github.com/repos/Gaye93/5MCSI_Metriques/commits';
            
            fetch(apiUrl)
                .then(response => {
                    if (!response.ok) throw new Error(`Erreur: ${response.status}`);
                    return response.json();
                })
                .then(commits => {
                    if (!commits || commits.length === 0) {
                        throw new Error('Aucun commit trouvé');
                    }
                    drawDateChart(commits);
                    drawMinuteChart(commits);
                })
                .catch(error => {
                    console.error(error);
                    document.getElementById('date_chart').innerHTML = 
                        `<div class="error">${error.message}</div>`;
                    document.getElementById('minute_chart').innerHTML = 
                        `<div class="error">${error.message}</div>`;
                });
        }

        function drawDateChart(commits) {
            // Groupement par date
            const dateCounts = {};
            
            commits.forEach(commit => {
                const dateStr = commit.commit.author.date;
                const date = new Date(dateStr);
                const formattedDate = date.toLocaleDateString('fr-FR', {
                    day: '2-digit',
                    month: 'short',
                    year: 'numeric'
                });
                
                dateCounts[formattedDate] = (dateCounts[formattedDate] || 0) + 1;
            });

            // Conversion en tableau et tri
            const dateData = Object.entries(dateCounts)
                .sort((a, b) => new Date(a[0]) - new Date(b[0]));

            // Préparation des données
            const data = new google.visualization.DataTable();
            data.addColumn('string', 'Date');
            data.addColumn('number', 'Commits');
            
            dateData.forEach(([date, count]) => {
                data.addRow([date, count]);
            });

            // Options du graphique
            const options = {
                title: '',
                hAxis: {
                    title: 'Date',
                    slantedText: true,
                    slantedTextAngle: 45,
                    showTextEvery: Math.ceil(dateData.length / 10)
                },
                vAxis: {
                    title: 'Nombre de commits',
                    minValue: 0
                },
                colors: ['#3498db'],
                bar: { groupWidth: '80%' },
                legend: { position: 'none' }
            };

            // Dessin
            const chart = new google.visualization.ColumnChart(document.getElementById('date_chart'));
            chart.draw(data, options);
        }

        function drawMinuteChart(commits) {
            // Comptage par minute
            const minuteCounts = Array(60).fill(0);
            
            commits.forEach(commit => {
                const dateStr = commit.commit.author.date;
                const minute = parseInt(dateStr.split('T')[1].substring(3, 5));
                minuteCounts[minute]++;
            });

            // Préparation des données
            const data = new google.visualization.DataTable();
            data.addColumn('string', 'Minute');
            data.addColumn('number', 'Commits');
            
            for (let m = 0; m < 60; m++) {
                data.addRow([m.toString(), minuteCounts[m]]);
            }

            // Options du graphique
            const options = {
                title: '',
                hAxis: {
                    title: 'Minute de l\'heure',
                    ticks: [0, 15, 30, 45, 59]
                },
                vAxis: {
                    title: 'Nombre de commits',
                    minValue: 0
                },
                colors: ['#e74c3c'],
                bar: { groupWidth: '95%' },
                legend: { position: 'none' }
            };

            // Dessin
            const chart = new google.visualization.ColumnChart(document.getElementById('minute_chart'));
            chart.draw(data, options);
        }
    </script>
</body>
</html>
